#!/usr/bin/env bash

set -euo pipefail

# Make Android udev rules working by appending user to adbusers group

GROUP="$(getent group adbusers)"

if [[ -z "${GROUP}" ]]; then
  echo "Group adbusers does not exist, please assure that it's created correctly"
  exit 1
fi

readarray -t AVAILABLE_USERS < <(getent passwd | awk -F: '/\/home/ {print $1}')

for user in "${AVAILABLE_USERS[@]}"; do
  if [[ ! "${GROUP}" =~ "${user}" ]]; then
    sudo gpasswd -a "${user}" adbusers
  else
    echo "Group adbusers is already assigned to the user '${user}'"
  fi
done
