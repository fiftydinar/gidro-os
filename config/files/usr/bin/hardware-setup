#!/usr/bin/env bash

# GLOBAL
INITRAMFS=$(rpm-ostree initramfs-etc)

# Apply initramfs-etc for module blacklists to work & apply LUKS partition trim fix
if [[ $INITRAMFS =~ "No tracked files." ]]; then
  echo "Found needed initramfs changes, applying."
  plymouth display-message --text="Updating initramfs - Please wait" || true
  rpm-ostree initramfs-etc --track /etc/crypttab --track /etc/modprobe.d/amdgpu.conf --track /etc/modprobe.d/blacklist.conf --force-sync --reboot
fi
