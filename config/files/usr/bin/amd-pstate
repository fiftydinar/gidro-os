#!/usr/bin/env bash

# GLOBAL
KARGS=$(rpm-ostree kargs)
NEEDED_KARGS=""
echo "Current kargs: $KARGS"

# KERNEL ARGUMENTS
if [[ ! $KARGS =~ "amd_pstate" ]]; then
  echo "Enabling amd-pstate driver"
  NEEDED_KARGS="$NEEDED_KARGS --append=amd_pstate=active"
fi

if [[ -n "$NEEDED_KARGS" ]]; then
  echo "Found needed karg changes, applying the following: $NEEDED_KARGS"
  rpm-ostree kargs ${NEEDED_KARGS} --reboot || exit 1
else
  echo "No karg changes needed"
fi
